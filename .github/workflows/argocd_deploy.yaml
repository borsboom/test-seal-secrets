name: ArgoCD Deploy #@@@

on:
  workflow_dispatch:
    inputs:
      argocd_app:
        description: Application name #@@@
        type: string
        required: true
        default: app1
      argocd_update_overlays:
        description: Update overlay names (space separated) #@@@
        type: string
        required: true
        default: dev azure-dev
      argocd_promote_overlays:
        description: Promote overlay names (space separated) #@@@
        type: string
        required: true
        default: test aws-test
      image_tag:
        description: Docker image tag #@@@
        type: string
        required: true
      commit_ref:
        description: Base Kustomization commit reference #@@@
        type: string
        required: true

jobs:
  update:
    name: Deploy
    uses: borsboom/seal-github-secrets-action/.github/workflows/argocd_deploy.yaml@main #TODO: SPECIFY TAG
    secrets: inherit
    with:
      #@@@ NEED github.event.?
      argocd_app: ${{ github.event.inputs.argocd_app }}
      argocd_update_overlays: ${{ github.event.inputs.argocd_update_overlays }}
      argocd_promote_overlays: ${{ github.event.inputs.argocd_promote_overlays }}
      image_tag: ${{ github.event.inputs.image_tag }}
      commit_ref: ${{ github.event.inputs.commit_ref }}
